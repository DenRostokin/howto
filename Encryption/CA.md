Создание собственного CA без помощи easy-rsa.

1. Создадим сруктуру дирекорий для CA:

$ mkdir -p ~/ca/{root-ca,sub-ca,server}/{private,certs,newcerts,crl,csr}

2. Установим права доступа для директорий private:

$ chmod -v 700 ca/{root-ca,sub-ca,server}/private

3. Создадим index-файлы к root-ca и sub-ca. Root-ca - это корневой УЦ, а sub-ca - промежуточный, авторизованный корневым УЦ:

$ touch ca/{root-ca,sub-ca}/index

4. Теперь необходимо создать файл с серийным номером размером 128 бит (16 байт) в директориях корневого и промежуточного УЦ:

$ openssl rand -hex 16 > ca/root-ca/serial
$ openssl rand -hex 16 > ca/sub-ca/serial

5. В директории ca/server/private мы будет хранить секретный ключ нашего CA. Мы создадим сразу секретный ключ и сертификат CA, подписанный этим ключом. Запрос на создание сертификата создаётся коммандой openssl req, которая использует под капотом утилиту openssl-req. В уроке предлагается создать пару ключей длиной 3072 бит по алгоритму RSA. Сначала сделаем так, в качестве примера, а потом удалим это и создадим пару на элиптической кривой, т.к. это шифрование более устойчиво.

$ openssl req -new -newkey rsa:3072 -days 365 -nodes -x509 -subj '/CN=www.example.com' -keyout server.key -out server.crt

где опции:

-new - новый запрос;
-newkey - создать новый секретный ключ. После этой опции нужно указать тип шифрования и длину ключа в битах;
-days - в течении какого времени сертификат будет валидным;
-nodes - не шифровать полученный ключ (не придётся вводить пароль);
-x509 - создать x509-сертификат вместо CSR. X.509 - это стандарт формата цифровых сертификатов. Если не указать опцию -x509, то мы получим CSR, а не уже подписанный сертификат, как в нашем случае!
-subj - позволяет указать поля в сертификате. Обязательным полем является CN - Common Name - это имя хоста, для которого выпускается сертификат;
-keyout - имя файла, в который будет записан секретный ключ. В данном случае это server.key;
-out - имя файла, в который будет записан подписанный сертификат;

В директории появятся 2 файла: server.key и server.crt.

Чтобы создать ключи на элиптических кривых используется следующая комманда:

$ openssl req -new -newkey ec -pkeyopt ec_paramgen_curve:prime256v1 -x509 -nodes -days 365 -out server.crt -keyout server.key

6. Для просмотра сертифика в текстовом режиме используется комманда:

$ openssl x509 -text -in server.crt -noout

Опция -noout говорит не записывать вывод в файл, а выводить на экран.

7. В уроке данные файлы удаляются, т.к. автор хочет показать другую возможность создания сертификатов!

$ rm *

8. Переходим в директория ca. Нам нужно создать 3 секретных ключа.
